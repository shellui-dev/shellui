@namespace BlazorInteractiveServer.Components.UI
@using BlazorInteractiveServer.Components

<CascadingValue Value="this" IsFixed="true">
    <div class="@Shell.Cn("relative inline-block text-left", Class)" @attributes="AdditionalAttributes">
        @if (UseCompositional)
        {
            @ChildContent
        }
        else
        {
            <button type="button"
                    @onclick="ToggleOpen"
                    class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 pl-4 pr-3 py-2">
                @Trigger
            </button>
            @if (IsOpen)
            {
                <div class="absolute right-0 z-50 mt-2 w-56 origin-top-right rounded-md border border-border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95">
                    @ChildContent
                </div>
            }
        }
    </div>
</CascadingValue>

@code {
    [Parameter] public RenderFragment? Trigger { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback<bool> IsOpenChanged { get; set; }
    [Parameter] public string? Class { get; set; }
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private bool UseCompositional => Trigger is null;

    public async Task ToggleAsync()
    {
        IsOpen = !IsOpen;
        await IsOpenChanged.InvokeAsync(IsOpen);
    }

    public async Task CloseAsync()
    {
        IsOpen = false;
        await IsOpenChanged.InvokeAsync(IsOpen);
    }

    private async Task ToggleOpen()
    {
        await ToggleAsync();
    }
}
