@namespace ShellUI.Components

<div class="relative @ClassName" @attributes="AdditionalAttributes">
    <button type="button"
            @onclick="Toggle"
            disabled="@Disabled"
            class="@("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 " + (Disabled ? "cursor-not-allowed opacity-50" : ""))">
        <span>@(string.IsNullOrEmpty(Value) ? Placeholder : Value)</span>
        <svg class="@("h-4 w-4 opacity-50 transition-transform " + (IsOpen ? "rotate-180" : ""))" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
    </button>
    
    @if (IsOpen)
    {
        <div class="absolute z-50 mt-1 w-full rounded-md border border-border bg-popover shadow-md animate-in fade-in-0 zoom-in-95">
            <div class="p-2">
                <input type="text"
                       @bind="searchQuery"
                       @bind:event="oninput"
                       placeholder="Search..."
                       class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
            </div>
            <div class="max-h-60 overflow-auto p-1">
                @ChildContent
            </div>
        </div>
    }
</div>

@if (IsOpen)
{
    <div class="fixed inset-0 z-40" @onclick="Close"></div>
}

@code {
    [Parameter]
    public string Value { get; set; } = "";
    
    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }
    
    [Parameter]
    public string Placeholder { get; set; } = "Select...";
    
    [Parameter]
    public bool Disabled { get; set; }
    
    [Parameter]
    public RenderFragment? ChildContent { get; set; }
    
    [Parameter]
    public string ClassName { get; set; } = "";
    
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }
    
    private bool IsOpen { get; set; }
    private string searchQuery = "";
    
    private void Toggle() => IsOpen = !IsOpen;
    private void Close() => IsOpen = false;
    
    public async Task SelectValue(string value)
    {
        Value = value;
        await ValueChanged.InvokeAsync(value);
        IsOpen = false;
    }
}

